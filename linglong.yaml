package:
  id: org.deepin.Runtime
  name: deepin runtime
  kind: runtime
  version: 5.15.7.1
  description: |
    Qt is a cross-platform C++ application framework. Qt's primary feature
    is its rich set of widgets that provide standard GUI functionality.

base:
  id: org.deepin.foundation
  version: 20.0.0

sources:
  - kind: git
    url: https://github.com/deepin-community/qtbase-opensource-src
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qtsvg-opensource-src
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qtdeclarative-opensource-src
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qtgraphicaleffects-opensource-src
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qtquickcontrols-opensource-src
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qtquickcontrols2-opensource-src
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qtscript-opensource-src
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qtxmlpatterns-opensource-src
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qtimageformats-opensource-src
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qtlocation-opensource-src
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qt5integration
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qtmultimedia-opensource-src
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qt3d-opensource-src
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qtcharts-opensource-src
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qtconnectivity-opensource-src
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qtgamepad-opensource-src
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qtsensors-opensource-src
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qtspeech-opensource-src
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qtvirtualkeyboard-opensource-src
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qtserialport-opensource-src
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qtnetworkauth-opensource-src
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qttools-opensource-src
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qtx11extras-opensource-src
    commit: master
  - kind: git
    url: https://github.com/deepin-community/qtwayland-opensource-src
    commit: master
  - kind: git
    url: https://github.com/linuxdeepin/qt5platform-plugins
    commit: 5.6.25
  - kind: git
    url: https://github.com/linuxdeepin/dtkcommon
    commit: 5.6.25
  - kind: git
    url: https://github.com/linuxdeepin/dtkcore
    commit: 5.6.25
  - kind: git
    url: https://github.com/linuxdeepin/dtkgui
    commit: 5.6.25
  - kind: git
    url: https://github.com/linuxdeepin/dtkwidget
    commit: 5.6.25
  - kind: git
    url: https://github.com/linuxdeepin/dtkdeclarative
    commit: 5.6.25
build:
  kind: manual
  manual:
    build: |
      # 安装xz
      mkdir -p $PREFIX/lib/x86_64-linux-gnu
      mkdir -p $PREFIX/bin
      cp build/liblzma.so.5 $PREFIX/lib/x86_64-linux-gnu
      cp build/xz $PREFIX/bin/
      # 配置环境变量
      export PATH=$PREFIX/bin:$PATH
      export PKG_CONFIG_PATH=$PREFIX/lib/x86_64-linux-gnu/pkgconfig
      export LIBRARY_PATH=$PREFIX/lib/x86_64-linux-gnu:$LIBRARY_PATH
      export LD_LIBRARY_PATH=$PREFIX/lib/x86_64-linux-gnu:$LD_LIBRARY_PATH
      export C_INCLUDE_PATH=$PREFIX/include:$PREFIX/include/x86_64-linux-gnu
      export CPLUS_INCLUDE_PATH=$PREFIX/include/c++/13:$C_INCLUDE_PATH
      export PERL5LIB=/runtime/local/lib/x86_64-linux-gnu/perl/5.28.1:/runtime/local/share/perl/5.28.1:/runtime/lib/x86_64-linux-gnu/perl5/5.28:/runtime/share/perl5:/runtime/lib/x86_64-linux-gnu/perl/5.28:/runtime/share/perl/5.28:/runtime/local/lib/site_perl:/runtime/lib/x86_64-linux-gnu/perl-base
      # 安装qbase构建依赖
      bash tools/deb-source.bash build/pool $PREFIX
      ## 更新pc文件
      for i in `ls $PKG_CONFIG_PATH/*.pc`; do
        sed "s#/usr#$PREFIX#g" $i > /tmp/${i##*/}
        cp /tmp/*.pc $PKG_CONFIG_PATH/
      done
      qtbase.bash
      qt-module-build.bash
